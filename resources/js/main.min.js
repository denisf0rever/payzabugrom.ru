(function () {
  document.addEventListener('DOMContentLoaded', function () {

    /*КАСТОМНЫЙ СЕЛЕКТ*/

    const selectWrapper = document.querySelectorAll('.calculation-form__select-wrapper');
    const select = document.querySelectorAll('.calculation-form__status-select');
    const selectArrow = document.querySelectorAll('.calculation-form__status-arrow');
    const selectOptions = document.querySelectorAll('.calculation-form__status-option');
    const selectInput = document.querySelectorAll('.calculation-form__status-current');

    selectOptions.forEach((el, key) => {
      if (selectInput.value === el.value) {
        el.classList.add('calculation-form__status-option-active');
      }
    });

    selectWrapper.forEach((el, key) => {
      el.onclick = () => {
        selectArrow[key].classList.toggle('calculation-form__rotate-arrow');
        select[key].classList.toggle('calculation-form__status-hide');
      };
    });

    selectWrapper.forEach((el, key) => {
      const selectOptions = el.querySelectorAll('.calculation-form__status-option');
      const selectInput = el.querySelector('.calculation-form__status-current');
      const span = el.querySelector('.calculation-form__span');
      selectOptions.forEach((el, key) => {
        el.onclick = () => {
          selectOptions.forEach((innerEl, innerKey) => {
            if (key === innerKey) {
              innerEl.classList.add('calculation-form__status-option-active');
              selectInput.setAttribute('value', innerEl.getAttribute('value'));
              selectInput.dispatchEvent(new Event('change')); // Вызов события change вручную
              span.innerHTML = innerEl.innerHTML;
            } else {
              innerEl.classList.remove('calculation-form__status-option-active');
            }
          });
        };
      });
    });

    /*ПОДСЧЕТ*/

    const calcPrice = () => {
      const priceDisplay = document.querySelector('.calculation-display__price');
      const priceInput = document.querySelector('.calculation-form__value');
      const formPrice = document.querySelector('.calculation-display__price-input');
      const comissionDisplay = document.querySelector('.calculation-display__tax-value');
      const currency = document.querySelector('#currency');
      const options = document.querySelector('#options');


      let currencyModificator = 87.10;
      let comission = 10;

      const setPrice = () => {
        formPrice.setAttribute('value', priceInput.value);
        priceDisplay.innerHTML = `
        ${Math.round(priceInput.value * currencyModificator + (priceInput.value * currencyModificator * comission / 100))} ₽
        `;
      }

      currency.addEventListener('change', (event) => {
        switch (currency.value) {
          case 'dollar':
            currencyModificator = 87.10;
            break;
          case 'euro':
            currencyModificator = 95.16;
            break;
          case 'lira':
            currencyModificator = 2.59;
            break;
          default:
            break;
        }

        setPrice();

      });

      options.addEventListener('change', (event) => {
        switch (options.value) {
          case 'option1':
            comission = 10;
            break;
          case 'option2':
            comission = 20;
            break;
          case 'option3':
            comission = 30;
            break;
          default:
            break;
        }

        comissionDisplay.innerHTML = `${comission}%`;


        setPrice();

      });


      priceInput.addEventListener('input', (event) => {

        setPrice();
      });

      // Добавьте логику для расчета здесь
    };

    calcPrice();

  });

  /*ВОПРОСЫ*/
  document.querySelectorAll('.question').forEach(question => {
    question.addEventListener('click', function () {
      const answerWrapper = this.querySelector('.question__ansver-wrapper');
      if (this.classList.contains('question__opened')) {
        // Animate collapse
        answerWrapper.style.maxHeight = `${answerWrapper.scrollHeight + 20}px`;
        answerWrapper.style.paddingTop = `0`;
        setTimeout(() => {
          answerWrapper.style.maxHeight = '0';
          this.classList.remove('question__opened');
        }, 0);
      } else {
        // Animate expansion
        this.classList.add('question__opened');
        answerWrapper.style.maxHeight = `${answerWrapper.scrollHeight + 20}px`;
        answerWrapper.style.paddingTop = `20px`;
        setTimeout(() => {
          answerWrapper.style.maxHeight = 'none';
        }, 300); // Duration should match the transition time
      }
    });
  });

  /* табы */


  const buttons = document.querySelectorAll('.cards__toggle-item');
  const contents = document.querySelectorAll('.cards__list');

  buttons.forEach(button => {
    button.addEventListener('click', function () {
      const tabId = this.getAttribute('data-tab');
      console.log(tabId);
      // Deactivate all tabs
      buttons.forEach(btn => btn.classList.remove('cards__toggle-item-active'));
      contents.forEach(content => content.classList.add('cards__hide'));

      // Activate the clicked tab and its content
      this.classList.add('cards__toggle-item-active');
      document.getElementById(tabId).classList.remove('cards__hide');
    });
  });

  /*табы 2 */

  const buttonsМVariant = document.querySelectorAll('.cards__toggle-item-variant');
  buttonsМVariant.forEach(button => {
    button.addEventListener('click', function () {
      const tabId = this.getAttribute('data-tab');
      console.log(tabId);
      // Deactivate all tabs
      buttonsМVariant.forEach(btn => btn.classList.remove('cards__toggle-item-variant-active'));
      contents.forEach(content => content.classList.add('cards__hide'));

      // Activate the clicked tab and its content
      this.classList.add('cards__toggle-item-variant-active');
      document.getElementById(tabId).classList.remove('cards__hide');
    });
  });

  // бургер

  const burger = document.querySelector('.header__burger');
  const burgerClose = document.querySelector('.header-mobile__close');
  const mobileMenu = document.querySelector('.header__mobile');
  const body = document.querySelector('body');

  if (burger) {
    burger.onclick = () => {
      mobileMenu.classList.add('header__mobile-open');
      body.style.overflow = 'hidden';
    }
  }

  if (burgerClose) {
    burgerClose.onclick = () => {
      mobileMenu.classList.remove('header__mobile-open');
      body.style.overflow = 'auto';
    }
  }

  document.addEventListener('click', (event) => {
    const target = event.target;

    if (!mobileMenu.contains(target) && !burger.contains(target)) {
      mobileMenu.classList.remove('header__mobile-open');
      body.style.overflow = 'auto';
    }
  });

})();
